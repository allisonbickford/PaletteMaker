<html>
    <body>
        <h1>
            Welcome!
        </h1>
        
        <div>
                    Today we are going to show you how to implement the camera on an Android <br>
                project. We will be using Kotlin to create our app. Starting off, create a new
                project in Android Studio.<br>
            
            <img src="assets/newproject.png" width="400" height="200"/>
            
            <br>
                    When prompted, choose “Empty Activity” and name your app. We have chosen
                “CameraDemo”, but please be as creative or functional as you desire! This app will <br>
                put images into a slideshow for your viewing pleasure (or your Mom’s)!<br>
            <p>
                    Make sure you have Kotlin enabled by verifying it is in your project-level<br>
                build.gradle dependencies:<br>
            <code>
                <pre>
                    dependencies {
                        classpath 'com.android.tools.build:gradle:3.5.2'
                        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
                        // NOTE: Do not place your application dependencies here; they belong
                        // in the individual module build.gradle files
                    }
                </pre>
            </code>
    
                    We didn’t change the module-level dependencies, but I will put them here so you
                can verify should any troubles arise: <br>
            
            <code>
                <pre>
                    dependencies {
                       implementation fileTree(dir: 'libs', include: ['*.jar'])
                       implementation"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
                       implementation 'androidx.appcompat:appcompat:1.1.0'
                       implementation 'androidx.core:core-ktx:1.1.0'
                       implementation 'androidx.constraintlayout:constraintlayout:1.1.3'
                       testImplementation 'junit:junit:4.12'
                       androidTestImplementation 'androidx.test.ext:junit:1.1.1'
                       androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'
                       implementation 'com.google.android.material:material:1.0.0'
                    }
                </pre>
            </code>

                    To start off, we need to make a place to put our images! Firstly, add a <br>
                "RelativeLayout" to your default ConstraintLayout. Put an ImageView into your <br>
                “activity_main.xml”. Select any image (we will be switching it out later). We are <br>
                using the id “main_image_view”. Make sure you change the layout_width and <br>
                layout_height to match_parent.<br>
                
            <video width="320" height="240" controls>
                <source src="assets/placingpieces.mp4" type="video/mp4">
            </video>


                    We will also add a FloatingActionButton to trigger the camera. Add a <br>
                FloatingActionButton to the screen and search for “camera” when prompted to choose <br>
                an icon. Use the icon “ic_menu_camera”. Give it a distinctive id. We will use <br>
                “camera_button”.<br>
                
                    Navigate to the “Text” tab in Android’s Layout Builder and add the following
                code below the id of your FloatingActionButton:<br>
                
            <code>
                <pre>
                    android:focusable="true"
                    android:layout_centerHorizontal="true"
                    android:layout_alignParentBottom="true"
                    android:layout_marginBottom="25dp"
                </pre>
            </code>
                <br>
                    This will align your button centered horizontally at the bottom of the screen, <br>
                leaving space between the bottom of the screen and your button.<br>
            
                    In order to use the camera, we have to register it in the AndroidManifest.xml.
                Add the following line between the manifest and application tags:<br>
            
            <code>
                <pre>
                    &lt;uses-feature android:name="android.hardware.camera"
                    android:required="true" /&gt;
                </pre>
            </code>

                    Next, we have to create an intent to the camera in our MainActivity. Add this <br>
                below your onCreate method:<br>
            
            <code>
                <pre>
                    val REQUEST_IMAGE_CAPTURE = 1
                    
                    private fun dispatchTakePictureIntent() {
                        Intent(MediaStore.ACTION_IMAGE_CAPTURE).also { takePictureIntent ->
                            takePictureIntent.resolveActivity(packageManager)?.also {
                                startActivityForResult(takePictureIntent, REQUEST_IMAGE_CAPTURE)
                            }
                        }
                    }
                </pre>
            </code>
                
                Be sure to add the following imports:<br>
            
            <code>
                <pre>
                    import android.content.Intent
                    import android.provider.MediaStore
                </pre>
            </code>
            
                    Let’s connect our button to the camera intent! In your MainActivity’s onCreate <br>
                function, add the following lines of code:<br>
            
            <code>
                <pre>
                    val cameraButton = findViewById&lt;FloatingActionButton&gt;(R.id.camera_button)
                    cameraButton.setOnClickListener { dispatchTakePictureIntent() }
                </pre>
            </code>
            
                    This is a great time to run your app and make sure it works. You should be able <br>
                to click the camera button, take a picture, and be sent back.<br>
                
            
            
                    Now that we can take a picture, let’s put it into our ImageView. Add the <br>
                following function to your MainActivity.<br>
            
            override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
                if (requestCode == REQUEST_IMAGE_CAPTURE && resultCode == RESULT_OK) {
                    val imageView = findViewById<ImageView>(R.id.main_image_view)
                    val imageBitmap = data?.extras?.get("data") as Bitmap
                    imageView.setImageBitmap(imageBitmap)
                }
                super.onActivityResult(requestCode, resultCode, data)
            }
            
                    When you successfully take a picture, this will set the image in the ImageView <br>
                to the picture you just took. Run your app and see how it works!<br>
            
            <img src="assets/blurrypicture.png" width="300px" height="550px"/>

                    Wow, that picture is blurry! Let’s make this look less like it came from a 2004 <br>
                Motorola phone, shall we? First, we have to save the image to our phone. In the <br>
                <AndroidManifest.xml, below the line we entered before with the tag uses-feature, <br>
                add the following:<br>
            
            <code>
                <pre>
                    &lt;uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" /&gt;
                </pre>
            </code>
                
                    This will let us put the image in storage. Now, let’s actually make the image. <br>
                This code will do that for us:<br>
                
            <code>
                <pre>
                    lateinit var currentPhotoPath: String
                    
                    @Throws(IOException::class)
                    private fun createImageFile(): File {
                       DateFormat.getDateTimeInstance()
                       val timeStamp: String = DateFormat.getDateTimeInstance().format(Date())
                       val storageDir: File? = getExternalFilesDir(Environment.DIRECTORY_PICTURES)
                       return File.createTempFile(
                           "JPEG_${timeStamp}_", /* prefix */
                           ".jpg", /* suffix */
                           storageDir /* directory */
                       ).apply {
                           // Save a file: path for use with ACTION_VIEW intents
                           currentPhotoPath = absolutePath
                       }
                    }
                </pre>
            </code>
                
                    Remember to import all the necessary packages. This will create an image named <br>
                after the current date and time. Once we’ve saved the file, we have to edit our <br>
                intent to call this function. Make the necessary changes to <br>
                dispatchTakePictureIntent()<br>
                
            <code>
                <pre>
                    private fun dispatchTakePictureIntent() {
                       Intent(MediaStore.ACTION_IMAGE_CAPTURE).also { takePictureIntent ->
                           // Ensure that there's a camera activity to handle the intent
                           takePictureIntent.resolveActivity(packageManager)?.also {
                               // NEW CODE STARTS HERE
                               val photoFile: File? = try {
                                   createImageFile()
                               } catch (ex: IOException) {
                                   // Error occurred while creating the File
                                   null
                               }
                               // Continue only if the File was successfully created
                               photoFile?.also {
                                   val photoURI: Uri = FileProvider.getUriForFile(
                                       this,
                                       "com.example.camerademo.fileprovider",
                                       it
                                   )
                                   takePictureIntent.putExtra(MediaStore.EXTRA_OUTPUT, photoURI)
                                   startActivityForResult(takePictureIntent, REQUEST_IMAGE_CAPTURE)
                               }
                           }
                       }
                    }
                </pre>
            </code>
                
                    We need a place for these photos. Add a resource directory named xml in the res <br>
                folder. Then, create a file called “file_paths”.<br>
             
            
            <video width="320" height="240" controls>
                <source src="assets/file_paths.mp4" type="video/mp4">
            </video>
            <br>
                
                Add the following code to the file_paths.xml you just made.
            
            <code>
                <pre>
                    &lt;?xml version="1.0" encoding="utf-8"?&gt;
                    &gt;paths xmlns:android="http://schemas.android.com/apk/res/android"&gt;
                        &lt;external-path name="my_images" path="Android/data/com.example.camerademo/files/Pictures" /&gt;
                    &lt;/paths&gt;
                </pre>
            </code>
            
                    Note: this requires you to enter your package in the path. Make sure to change <br>
                it if you didn’t use the name “camerademo” for your app.<br>
            
                    We’re almost done! Once we have that set up, we have to add a provider in our <br>
                AndroidManifest.xml to help handle these files. Inside the application tags, add <br>
                the following:<br>
            
            <code>
                <pre>
                    &lt;provider
                        android:name="androidx.core.content.FileProvider"
                        android:authorities="com.example.camerademo.fileprovider"
                        android:exported="false"
                        android:grantUriPermissions="true">
                        &lt;meta-data
                            android:name="android.support.FILE_PROVIDER_PATHS"
                            android:resource="@xml/file_paths"&gt;&lt;/meta-data&gt;
                    &lt;/provider&gt;
                </pre>
            </code>
            
                    Make sure that the value in android:authorities is unique for this project, <br>
                you’ll run into issues if you try to use the same provider in more than one app!<br>

            <img src="assets/clearimage.png" width=300px height=550px/><br>
            
                    That image looks much clearer. Lets add more! In MainActivity, make an array <br>
                of strings:<br>
            <code>
                <pre>
                    val pictures = ArrayList&lt;String&gt;()
                </pre>
            </code>
            
                    Now, when we take a picture we can add it to this array in our function <br>
                onActivityResult before when we set the image into our ImageView.<br>
            
            <code>
                <pre>
                    pictures.add(currentPhotoPath)
                </pre>
            </code>
            
                    How can we go through these pictures? Let’s make clicking on the ImageView go <br>
                to the next image. Add a new variable to our class.<br>
            
            <code>
                <pre>
                    var index = 0
                </pre>
            </code>
            
                Now make clicking the ImageView iterate through our pictures in onCreate.<br>
            
            <code>
                <pre>
                    val imageView = findViewById&lt;ImageView&gt;(R.id.main_image_view)
                    imageView.setOnClickListener {
                        if (pictures.size > index) {
                            imageView.setImageURI(Uri.fromFile(File(pictures[index])))
                            index++
                        } else {
                            index = 0
                            if (pictures.size > 0) {
                                imageView.setImageURI(Uri.fromFile(File(pictures[index])))
                            }
                        }
                    }        
                </pre>
            </code>

                That’s it! Take some pictures and loop through them!<br>
                <br>
                    The PaletteMaker app can be used for a variety of reasons, such as coming up <br>
                with elegant color schemes for mobile app/ web development, and also to ease <br>
                accessibility for those visually impaired with determining suitable contrast <br>
                of colors. The app raises zero concern for security as it uses no third party <br>
                components, with all information collected on the app being stored on the users <br>
                device directly. Make use of the PaletteMaker as a great tool for creating <br>
                color schemes. <br>
                
        </div>
    </body>
</html>